% %rng default
% sDist = mod(rad2deg(circ_vmrnd(pi/2, 2, 100)), 360); % generate sample, convert to deg
% 
% 
% angle_deg = [0  90   180  180+90];
% score_VA=[0.5000    0.1000    0.9000    0.5000];
% bin_one=round(score_VA.*100);
% %sDist= angle_deg.*bin_one
% 
% sDist= [];
% for hi=1:length(angle_deg)
% sDist=[sDist ones(1,bin_one(hi))*angle_deg(hi)'];
% end
% 
% 
% nBins = 4; % number of bins, makes bin size of 10 deg
% %Plot the circular histogram:
% fH = figure;
% ax = polaraxes(fH);
% ax.ThetaDir= 'clockwise';
% obj1 = CircHist(sDist, nBins, 'parent', ax,'edges', -45:90:315);
% %obj1 = CircHist(sDist, nBins, 'parent', ax,'edges', -45:90:360);
% 
% fH.Visible = 'on';
close all
clear all
addpath([cd '/github_repo']);

load FLAP_pilot.mat

theoriginalPRLs=thePRLs;
    thePRLs=-theoriginalPRLs;

  angle_deg = [0  90   180  180+90];
subjs=11;
for ui=1:length(thePRLs)
[theta,rho] = cart2pol(thePRLs(ui,1), thePRLs(ui,2));
PRL(ui,1)=theta;
PRL(ui,2)=rho;
end


PRL=PRL(2:2:end,:);
theNamesList=1:2:22;
  stops=1:10:(subjs*10);
stopsAcc=1:5:(subjs*5);
  for ui=1:subjs
subj{ui}=FLAP_pilot(stops(ui):stops(ui)+9,:);
  end

FLAP_pilot_ACC=FLAP_pilot(1:2:end,:);
FLAP_pilot_RT=FLAP_pilot(2:2:end,:);

  for ui=1:subjs
subjAcc{ui}=FLAP_pilot_ACC(stopsAcc(ui):stopsAcc(ui)+4,:);
  end 

  for ui=1:subjs
subjRT{ui}=FLAP_pilot_RT(stopsAcc(ui):stopsAcc(ui)+4,:);
  end

  allsubjnorm=[];
  %remove the attention data because it's pre-processed (cued-uncued)
  for ui=1:subjs
%subjAccprenorm{ui}=subjAcc{ui}(1:3,:);
 %newsubj=subjAccprenorm{1};
 newsubj=subjAcc{ui}(1:3,:);
  allsubjnorm=[allsubjnorm ;newsubj];
  end 

  %normalize VA and crowding
  allsubjnorm=mat2gray(allsubjnorm);
normalizedVA=allsubjnorm(1:3:end,:);
normalizedCWrad=allsubjnorm(2:3:end,:);
normalizedCWtan=allsubjnorm(3:3:end,:);

%normalize attention score
% extract attention data
allsubjprenormAtt=[];
  for ui=1:subjs
newsubj=subjAcc{ui}(4:5,:);
  allsubjprenormAtt=[allsubjprenormAtt ;newsubj];
  end 
  
  allsubjnormAtt=mat2gray(allsubjprenormAtt);
  
%more 'normalization': now high is better (before low was better)  
  allsubjnormAtt=1-allsubjnormAtt;
normalizedshortAtt=allsubjnormAtt(1:2:end,:);
normalizedlongAtt=allsubjnormAtt(2:2:end,:);


%for ui=1:subj

    for ui=1

        
        lenom=theNames{theNamesList(ui)};
        lenom=cell2mat(lenom);
    lenom=lenom(1:2);
    score_VA = normalizedVA(ui,:);
    score_CWrad = normalizedCWrad(ui,:);   
        score_CWtan = normalizedCWtan(ui,:);  
score_attshort=normalizedshortAtt(ui,:);   
score_attlong=normalizedlongAtt(ui,:);   

% bin_one=score_VA;
% bin_two=score_CWrad;
% bin_three=score_CWtan;
% bin_four=score_attshort;
% bin_five=score_attshort;

nBins = 4; % Use different number of bins, resulting in 20 deg bins
fH = figure('Visible', 'on');
subAx1 = subplot(1, 2, 1, polaraxes);
obj1 = CircHist(score_VA, nBins, 'parent', subAx1,'edges', -45:90:315,'areAxialData', true, 'dataType', 'histogram');
obj1.colorAvgAng= [.71 0 0];
obj1.colorBar=[.71 0 0 ];
obj1.baseLineOffset=10;

thetaticks(obj1.polarAxs, 0:90:360);
obj1.polarAxs.ThetaAxis.MinorTickValues = [];

% Make rho-axes equal for both diagrams
maxRho = max([max(rlim(subAx1))])%, max(rlim(subAx3)), max(rlim(subAx4))]);
newLimits = [min(rlim(subAx1)), maxRho];
obj1.setRLim(newLimits);

if PRL(ui,2)>0
dio=polarplot(subAx1,(PRL(ui,1)-deg2rad(90)), -0.5,'ko', 'MarkerFaceColor', 'y')
elseif PRL(ui,2)<0
    dio=polarplot(subAx1,(PRL(ui,1)-deg2rad(90)), 0.5,'ko', 'MarkerFaceColor', 'y')
end

subAx1.ThetaDir= 'clockwise';
 subAx1.ThetaZeroLocation = 'top'; 
 
% Adjust figure-window size
drawnow
%fH.Position([3,4]) = [16*70,9*70]; % Figure dimensions

fH.Position([3,4]) = [850,500]; % Figure dimensions



print([ lenom 'VA_polar_angle'], '-dpng', '-r300'); %<-Save as PNG with 300 DPI

 
 fH2 = figure('Visible', 'on');

subAx2 = subplot(1, 2, 1, polaraxes);
subAx3 = subplot(1, 2, 2, polaraxes);

obj2 = CircHist(score_CWrad, nBins, 'parent', subAx2, 'edges', -45:90:315,'areAxialData', false, 'dataType', 'histogram');
obj3 = CircHist(score_CWtan, nBins, 'parent', subAx3, 'edges', -45:90:315,'areAxialData', false, 'dataType', 'histogram');


obj2.colorAvgAng= [.3 0.3 0.3];
obj2.colorBar=[.31 0.3 0.29 ];
obj2.baseLineOffset=10;


obj3.colorAvgAng= [0 0 .71];
obj3.colorBar=[0 0 .71 ];
obj3.baseLineOffset=10;

thetaticks(obj2.polarAxs, 0:90:360);
obj2.polarAxs.ThetaAxis.MinorTickValues = [];
thetaticks(obj3.polarAxs, 0:90:360);
obj3.polarAxs.ThetaAxis.MinorTickValues = [];


% Make rho-axes equal for both diagrams
maxRho = max([max(rlim(subAx2)), max(rlim(subAx3))])%, max(rlim(subAx3)), max(rlim(subAx4))]);
newLimits = [min(rlim(subAx2)), maxRho];

obj2.setRLim(newLimits);
obj3.setRLim(newLimits);

if PRL(ui,2)>0
dio=polarplot(subAx3,(PRL(ui,1)-deg2rad(90)), -0.5,'ko', 'MarkerFaceColor', 'y')
dio=polarplot(subAx2,(PRL(ui,1)-deg2rad(90)), -0.5,'ko', 'MarkerFaceColor', 'y')
elseif PRL(ui,2)<0
    dio=polarplot(subAx3,(PRL(ui,1)-deg2rad(90)), 0.5,'ko', 'MarkerFaceColor', 'y')
    dio=polarplot(subAx2,(PRL(ui,1)-deg2rad(90)), 0.5,'ko', 'MarkerFaceColor', 'y')
end


subAx2.ThetaDir= 'clockwise';
subAx3.ThetaDir= 'clockwise';

 subAx2.ThetaZeroLocation = 'top';
 subAx3.ThetaZeroLocation = 'top';
 
 fH2.Position([3,4]) = [850,500]; % Figure dimensions

%polarplot(PRL(ui,1), subAx1)
%obj1.MarkerSize = 12;
% dio=polarplot(subAx1,PRL(ui,1), subAx1)
%dio.MarkerSize = 12;
 %dio.Marker= 'o';
 %dio.MarkerFaceColor= 'y';
  %dio.MarkerColor= 'k'
% dio.MarkerFaceColor= 'k';

print([ 'test_newpolar3'], '-dpng', '-r300'); %<-Save as PNG with 300 DPI


    end