%Script to generate the trialmatrix for the FLAP training condition 2
%Marcello Maniglia January 2022
clear all
close all
io=0;
diditclose=0;
%while diditclose<1
%try
    
    io=io+1;
clc
typeofcue=2; % endo, exo
stop_start=1;
PRLlocations=12;

for qq=1:typeofcue

    seu=fullfact([PRLlocations PRLlocations]);
    seu(seu(:,1)~=seu(:,2),:);
    permut=size(seu);
    position_to_switch=permut(1); %permutations of n locations

%-press a key whenever a red-circle appears in a series of other colored-circles (each 2°, presented at 4Hz, 150ms stimulus duration 100ms ISI), with a target presented every 2-4s.
%- After 3-6 trials of sustained performance in a given location, a cue will prompt participants that the next trial will occur in a new location. 
%-Participants must switch attention and make an eye-movement to perform the task in the new location. 
%-Further, timing is unpredictable (e.g. the cues are presented after varying times spent with attention toward a given target)
%-two types of cues: 
%1)the exogenous cue is a high-contrast ring that identifies the new target location; 
%2)the endogenous cue is an arrow at the previous location that indicates direction but not distance of the new target, along with a low contrast ring that indicates the location of the new target.

% 4 types of trials for each combination of switch (4 locations to 3 other possible locations): 3 and 4 targets per stream
%4 types of trial pfor each combination for endo and exo separately


%%
d=fullfact([ PRLlocations PRLlocations]);
c=d(:,1)==d(:,2);
f=d(~c,:);

newf=f(randi(length(f)),:);


trialnumber=500;
newnewf=[];
for op=1:trialnumber
    deplet=1:PRLlocations;
newdep=deplet(deplet~=(newf(1)) & deplet~=(newf(2)));
newf=[newf(2) newdep(randi(length(newdep)))]
    newnewf=[newnewf; newf]
  %  newf=tempf
end


newmatrix=[];

for ui=1:trialnumber
    targetnum=randi(3); 
   % for oi=1:randi(3) %how many targets per stream
    firsttrial=[ 3 newnewf(ui,1) newnewf(ui,:) randi(4)]
    for ei=1:randi(3) %add dummy trial
    midtrial(ei,:)=[1 newnewf(ui,1) newnewf(ui,:) 5]
    end
  %  end
    tempo=[firsttrial; midtrial]
    if targetnum>2
          firsttrial2=[ 3 newnewf(ui,1) newnewf(ui,:) randi(4)]
    for ei=1:randi(3) %add dummy trial
    midtrial2(ei,:)=[1 newnewf(ui,1) newnewf(ui,:) 5]
    end 
        tempo=[tempo; firsttrial2; midtrial2];
    end   
    if targetnum==3
               firsttrial3=[ 3 newnewf(ui,1) newnewf(ui,:) randi(4)]
    for ei=1:randi(3) %add dummy trial
    midtrial3(ei,:)=[1 newnewf(ui,1) newnewf(ui,:) 5]
    end 
        tempo=[tempo; firsttrial3; midtrial3];         
    end
        lasttrial=[1 newnewf(ui,1) newnewf(ui,:) 99]   
    newmatrix=[newmatrix; tempo;lasttrial ]    
end
tot_trial=newmatrix;





trialmatrix(1,3)=randi(4);
      
        mixtr2=mixtr;           
mixtr=[mixtr2(:,1), ones(length(mixtr2),1)];       
        response=zeros(length(newmatrix),2)-1; %intialize response matrix with -1

     
% when cue=2-> exogenous. it doesn't precede the target, i.e., it is not shown in the trial n-1, but rather in the
% trial n. I need a loop that looks for cue==2 and removes the cue from the
% previous trial.
%         
        
if qq==1
newnewmatrix=[ones(length(newtrialmatrix),1) newtrialmatrix];

elseif qq==2
    newnewmatrix2=[ones(length(newtrialmatrix),1)*2 newtrialmatrix];

end 


end
%%
                
        %mixtr for endogenous
        
        newnewtrialmatrix=[newnewmatrix(:,1:2) newnewmatrix(:,2) newnewmatrix(:,3:4) ];
        
                %mixtr for exogenous

                newnewtrialmatrix2=[newnewmatrix2(:,1:2) newnewmatrix2(:,2) newnewmatrix2(:,3:4) ];

                
                % now I need to tell the mixtr when to present the cue for
                % the exogenous condition, i.e., keep the '1' in first
                % column for the first switch (appearance of the cue),
                % replace with '0' for all the other conditions
                
                
                
                for dd=2:length(newnewtrialmatrix2)
                    if newnewtrialmatrix2(dd,2) ~= newnewtrialmatrix2(dd-1,2)
                    newnewtrialmatrix2(dd-1,:)=[ newnewtrialmatrix2(dd-1,1:end-1) 5];
                    newnewtrialmatrix2(dd,:)=[0 newnewtrialmatrix2(dd,2:end)];
%                 elseif trialmatrix(dd-1,2)==2
%                     trialmatrix(dd-1,:)=[trialmatrix(dd-1,1:2) 7];
%                     
                    end
                end
                
                                                                          
                %%  %breaks in the session 
                % endo
                possiblebreaks=[];
                for dd=20:length(newnewtrialmatrix)-5
                    if newnewtrialmatrix(dd+2,2) && newnewtrialmatrix(dd+1,2) && newnewtrialmatrix(dd,2) == newnewtrialmatrix(dd-1,2) && newnewtrialmatrix(dd+2,5) ==5 && newnewtrialmatrix(dd+1,5) ==5 && newnewtrialmatrix(dd,5) ==5 &&  newnewtrialmatrix(dd-1,5)==5
                 possiblebreaks=[possiblebreaks dd];
                    end
                end
                               
                                % exo
                possiblebreaks2=[];
                for dd=20:length(newnewtrialmatrix2)-5
                    if newnewtrialmatrix2(dd+2,2) && newnewtrialmatrix2(dd+1,2) && newnewtrialmatrix2(dd,2) == newnewtrialmatrix2(dd-1,2) && newnewtrialmatrix2(dd+2,5) ==5 && newnewtrialmatrix2(dd+1,5) ==5 && newnewtrialmatrix2(dd,5) ==5 &&  newnewtrialmatrix2(dd-1,5)==5
                 possiblebreaks2=[possiblebreaks2 dd];
                    end
                end
                               
                ntrialperblock=round(length(newnewtrialmatrix)/5);
                candidates=possiblebreaks(find(possiblebreaks>ntrialperblock));
                
                ntrialperblock2=round(length(newnewtrialmatrix2)/5);
                candidates2=possiblebreaks2(find(possiblebreaks2>ntrialperblock2));
                
                thebreaks=(length(candidates)+1)/5;
                thebreaks2=(length(candidates2)+1)/5;
                
                thebreaks=5;
                thebreaks2=thebreaks;
                
                trialbreak=[];
                trialbreak2=[];
                             
totaltrialbreak=[trialbreak trialbreak2+length(newnewtrialmatrix)];
totalnewnewtrial=[newnewtrialmatrix; newnewtrialmatrix2];
totalnewnewtrial_incongruent=totalnewnewtrial;
        
% how many incongruent trials? here we decide
trialincongruent_endo=round(number_of_hold_trials*.2); % 20% incongruent
trialincongruent_exo=round(number_of_hold_trials*.5); % 50% incongruent

n=[zeros(1,number_of_hold_trials-trialincongruent_endo) ones(1,trialincongruent_endo)];

arrayori1=n(randperm(length(n)));
arrayori2=n(randperm(length(n)));
arrayori3=n(randperm(length(n)));
arrayori4=n(randperm(length(n)));
arrayori5=n(randperm(length(n)));
arrayori6=n(randperm(length(n)));
arrayori7=n(randperm(length(n)));
arrayori8=n(randperm(length(n)));
arrayori9=n(randperm(length(n)));
arrayori10=n(randperm(length(n)));
arrayori11=n(randperm(length(n)));
arrayori12=n(randperm(length(n)));

counter1=0;
counter2=0;
counter3=0;
counter4=0;
counter5=0;
counter6=0;
counter7=0;
counter8=0;
counter9=0;
counter10=0;
counter11=0;
counter12=0;

n_exo=[zeros(1,number_of_hold_trials-trialincongruent_exo) ones(1,trialincongruent_exo)];

arrayori1_exo=n_exo(randperm(length(n_exo)));
arrayori2_exo=n_exo(randperm(length(n_exo)));
arrayori3_exo=n_exo(randperm(length(n_exo)));
arrayori4_exo=n_exo(randperm(length(n_exo)));
arrayori5_exo=n_exo(randperm(length(n_exo)));
arrayori6_exo=n_exo(randperm(length(n_exo)));
arrayori7_exo=n_exo(randperm(length(n_exo)));
arrayori8_exo=n_exo(randperm(length(n_exo)));
arrayori9_exo=n_exo(randperm(length(n_exo)));
arrayori10_exo=n_exo(randperm(length(n_exo)));
arrayori11_exo=n_exo(randperm(length(n_exo)));
arrayori12_exo=n_exo(randperm(length(n_exo)));

counter1_exo=0;
counter2_exo=0;
counter3_exo=0;
counter4_exo=0;
counter5_exo=0;
counter6_exo=0;
counter7_exo=0;
counter8_exo=0;
counter9_exo=0;
counter10_exo=0;
counter11_exo=0;
counter12_exo=0;

        kk1=0;
        kk2=0;
        kk3=0;
        kk4=0;
               
        %% add incongruent trials
totalnewnewtrial_incongruent=totalnewnewtrial;

for dd=2:length(totalnewnewtrial_incongruent)
    if totalnewnewtrial_incongruent(dd,1)==1 && totalnewnewtrial_incongruent(dd,5)>5
        kk1=kk1+1;
        if totalnewnewtrial_incongruent(dd,3)==1 && totalnewnewtrial_incongruent(dd,4)==2
            counter1=counter1+1;
            if arrayori1(counter1)==1
                cueori=[ 7 8 9];
                thecue=totalnewnewtrial_incongruent(dd,5);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[totalnewnewtrial_incongruent(dd,1:4) thenewcue];
            end
        elseif totalnewnewtrial_incongruent(dd,3)==1 && totalnewnewtrial_incongruent(dd,4)==3
            counter2=counter2+1;
            if arrayori2(counter2)==1
                 cueori=[ 7 8 9];
                thecue=totalnewnewtrial_incongruent(dd,5);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[totalnewnewtrial_incongruent(dd,1:4) thenewcue];
            end
        elseif totalnewnewtrial_incongruent(dd,3)==2 && totalnewnewtrial_incongruent(dd,4)==1
            counter3=counter3+1;          
            if arrayori3(counter3)==1
                 cueori=[6  8 9];
                thecue=totalnewnewtrial_incongruent(dd,5);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[totalnewnewtrial_incongruent(dd,1:4) thenewcue];
            end
        elseif totalnewnewtrial_incongruent(dd,3)==2 && totalnewnewtrial_incongruent(dd,4)==3
            counter4=counter4+1;
            if arrayori4(counter4)==1
                 cueori=[6  8 9];
                thecue=totalnewnewtrial_incongruent(dd,5);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[totalnewnewtrial_incongruent(dd,1:4) thenewcue];
            end
        elseif totalnewnewtrial_incongruent(dd,3)==3 && totalnewnewtrial_incongruent(dd,4)==1
            counter5=counter5+1;
            if arrayori5(counter5)==1
                 cueori=[6 7  9];
                thecue=totalnewnewtrial_incongruent(dd,5);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[totalnewnewtrial_incongruent(dd,1:4) thenewcue];
            end
        elseif totalnewnewtrial_incongruent(dd,3)==3 && totalnewnewtrial_incongruent(dd,4)==2
            counter6=counter6+1;
            if arrayori6(counter6)==1
                 cueori=[6 7  9];
                thecue=totalnewnewtrial_incongruent(dd,5);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[totalnewnewtrial_incongruent(dd,1:4) thenewcue];
            end          
             elseif totalnewnewtrial_incongruent(dd,3)==1 && totalnewnewtrial_incongruent(dd,4)==4
            counter7=counter7+1;
            if arrayori7(counter7)==1
                 cueori=[ 7 8 9];
                thecue=totalnewnewtrial_incongruent(dd,5);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[totalnewnewtrial_incongruent(dd,1:4) thenewcue];
            end
                         elseif totalnewnewtrial_incongruent(dd,3)==2 && totalnewnewtrial_incongruent(dd,4)==4
            counter8=counter8+1;
            if arrayori8(counter8)==1
                 cueori=[6  8 9];
                thecue=totalnewnewtrial_incongruent(dd,5);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[totalnewnewtrial_incongruent(dd,1:4) thenewcue];
            end
                       
                         elseif totalnewnewtrial_incongruent(dd,3)==3 && totalnewnewtrial_incongruent(dd,4)==4
            counter9=counter9+1;
            if arrayori9(counter9)==1
                 cueori=[6 7  9];
                thecue=totalnewnewtrial_incongruent(dd,5);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[totalnewnewtrial_incongruent(dd,1:4) thenewcue];
            end           
                         elseif totalnewnewtrial_incongruent(dd,3)==4 && totalnewnewtrial_incongruent(dd,4)==1
            counter10=counter10+1;
            if arrayori10(counter10)==1
                 cueori=[6 7 8 ];
                thecue=totalnewnewtrial_incongruent(dd,5);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[totalnewnewtrial_incongruent(dd,1:4) thenewcue];
            end
                         elseif totalnewnewtrial_incongruent(dd,3)==4 && totalnewnewtrial_incongruent(dd,4)==2
            counter11=counter11+1;
            if arrayori11(counter11)==1
                 cueori=[6 7 8 ];
                thecue=totalnewnewtrial_incongruent(dd,5);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[totalnewnewtrial_incongruent(dd,1:4) thenewcue];
            end
                         elseif totalnewnewtrial_incongruent(dd,3)==4 && totalnewnewtrial_incongruent(dd,4)==3
            counter12=counter12+1;
            if arrayori12(counter12)==1
                 cueori=[6 7 8 ];
                thecue=totalnewnewtrial_incongruent(dd,5);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[totalnewnewtrial_incongruent(dd,1:4) thenewcue];
            end
        end       
    elseif totalnewnewtrial_incongruent(dd,1)==0 
        kk3=kk3+1;
        wh=randi(10);                      
        if totalnewnewtrial_incongruent(dd-1,3)==1 && totalnewnewtrial_incongruent(dd-1,4)==2
            counter1_exo=counter1_exo+1;
            if arrayori1_exo(counter1_exo)==1
                             cueori=[ 2 3 4];
                thecue=totalnewnewtrial_incongruent(dd,2);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[ totalnewnewtrial_incongruent(dd,1) thenewcue totalnewnewtrial_incongruent(dd,3:5)];
            end            
        elseif totalnewnewtrial_incongruent(dd-1,3)==1 && totalnewnewtrial_incongruent(dd-1,4)==3
            counter2_exo=counter2_exo+1;
            if arrayori2_exo(counter2_exo)==1
                             cueori=[ 2 3 4];
                thecue=totalnewnewtrial_incongruent(dd,2);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[ totalnewnewtrial_incongruent(dd,1) thenewcue totalnewnewtrial_incongruent(dd,3:5)];
            end            
        elseif totalnewnewtrial_incongruent(dd-1,3)==2 && totalnewnewtrial_incongruent(dd-1,4)==1
            counter3_exo=counter3_exo+1;
            if arrayori3_exo(counter3_exo)==1
                             cueori=[1  3 4];
                thecue=totalnewnewtrial_incongruent(dd,2);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[ totalnewnewtrial_incongruent(dd,1) thenewcue totalnewnewtrial_incongruent(dd,3:5)];
            end
        elseif totalnewnewtrial_incongruent(dd-1,3)==2 && totalnewnewtrial_incongruent(dd-1,4)==3
            counter4_exo=counter4_exo+1;
            if arrayori4_exo(counter4_exo)==1
                             cueori=[1  3 4];
                thecue=totalnewnewtrial_incongruent(dd,2);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[ totalnewnewtrial_incongruent(dd,1) thenewcue totalnewnewtrial_incongruent(dd,3:5)];
            end
        elseif totalnewnewtrial_incongruent(dd-1,3)==3 && totalnewnewtrial_incongruent(dd-1,4)==1
            counter5_exo=counter5_exo+1;
            if arrayori5_exo(counter5_exo)==1
                             cueori=[1 2  4];
                thecue=totalnewnewtrial_incongruent(dd,2);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[ totalnewnewtrial_incongruent(dd,1) thenewcue totalnewnewtrial_incongruent(dd,3:5)];
            end
        elseif totalnewnewtrial_incongruent(dd-1,3)==3 && totalnewnewtrial_incongruent(dd-1,4)==2
            counter6_exo=counter6_exo+1;
            if arrayori6_exo(counter6_exo)==1
                             cueori=[1 2  4];
                thecue=totalnewnewtrial_incongruent(dd,2);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[ totalnewnewtrial_incongruent(dd,1) thenewcue totalnewnewtrial_incongruent(dd,3:5)];
            end          
            elseif totalnewnewtrial_incongruent(dd-1,3)==1 && totalnewnewtrial_incongruent(dd-1,4)==4
            counter7_exo=counter7_exo+1;
            if arrayori7_exo(counter7_exo)==1
                             cueori=[ 2 3 4];
                thecue=totalnewnewtrial_incongruent(dd,2);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[ totalnewnewtrial_incongruent(dd,1) thenewcue totalnewnewtrial_incongruent(dd,3:5)];
            end           
            elseif totalnewnewtrial_incongruent(dd-1,3)==2 && totalnewnewtrial_incongruent(dd-1,4)==4
            counter8_exo=counter8_exo+1;
            if arrayori8_exo(counter8_exo)==1
                             cueori=[1  3 4];
                thecue=totalnewnewtrial_incongruent(dd,2);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[ totalnewnewtrial_incongruent(dd,1) thenewcue totalnewnewtrial_incongruent(dd,3:5)];
            end            
            elseif totalnewnewtrial_incongruent(dd-1,3)==3 && totalnewnewtrial_incongruent(dd-1,4)==4
            counter9_exo=counter9_exo+1;
            if arrayori9_exo(counter9_exo)==1
                             cueori=[1 2 3 4];
                thecue=totalnewnewtrial_incongruent(dd,2);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[ totalnewnewtrial_incongruent(dd,1) thenewcue totalnewnewtrial_incongruent(dd,3:5)];
            end           
            elseif totalnewnewtrial_incongruent(dd-1,3)==4 && totalnewnewtrial_incongruent(dd-1,4)==1
            counter10_exo=counter10_exo+1;
            if arrayori10_exo(counter10_exo)==1
                             cueori=[1 2 3 ];
                thecue=totalnewnewtrial_incongruent(dd,2);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[ totalnewnewtrial_incongruent(dd,1) thenewcue totalnewnewtrial_incongruent(dd,3:5)];
            end            
            elseif totalnewnewtrial_incongruent(dd-1,3)==4 && totalnewnewtrial_incongruent(dd-1,4)==2
            counter11_exo=counter11_exo+1;
            if arrayori11_exo(counter11_exo)==1
                             cueori=[1 2 3 ];
                thecue=totalnewnewtrial_incongruent(dd,2);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[ totalnewnewtrial_incongruent(dd,1) thenewcue totalnewnewtrial_incongruent(dd,3:5)];
            end            
            elseif totalnewnewtrial_incongruent(dd-1,3)==4 && totalnewnewtrial_incongruent(dd-1,4)==3
            counter12_exo=counter12_exo+1;
            if arrayori12_exo(counter12_exo)==1
                             cueori=[1 2 3 ];
                thecue=totalnewnewtrial_incongruent(dd,2);
                otherc=cueori(cueori~=thecue);
                thenewcue=otherc(randi(2));
                totalnewnewtrial_incongruent(dd,:)=[ totalnewnewtrial_incongruent(dd,1) thenewcue totalnewnewtrial_incongruent(dd,3:5)];
            end
        end
    end
end

        totalnewnewtrial_incongruent_exo=totalnewnewtrial_incongruent(totalnewnewtrial_incongruent(:,1)~=1,:);       
        
        if stop_start==1
 totalnewnewtrial_incongruent2=totalnewnewtrial_incongruent;
                 contati=0;
                 contati2=0;
                 contati3=0;
        totalnewnewtrial_incongruent2=[];
        for riu=2:length(totalnewnewtrial_incongruent)
            if totalnewnewtrial_incongruent(riu-1,5)>5
                contati=contati+1;
                dumm=[3 totalnewnewtrial_incongruent(riu,2:end)];
            totalnewnewtrial_incongruent2=[totalnewnewtrial_incongruent2; totalnewnewtrial_incongruent(riu,:); dumm];
            dumm=[];
            elseif totalnewnewtrial_incongruent(riu,1)==0
                 contati2=contati2+1;
                dumm=[3 totalnewnewtrial_incongruent(riu,2:end)];
            totalnewnewtrial_incongruent2=[totalnewnewtrial_incongruent2; totalnewnewtrial_incongruent(riu,:); dumm];
            dumm=[];               
            elseif totalnewnewtrial_incongruent(riu-1,1)==1 && totalnewnewtrial_incongruent(riu,1)==2
                
                 contati3=contati3+1;
                 
                 totalnewnewtrial_incongruent2(riu,:)=[3 totalnewnewtrial_incongruent(riu,2:end-1) 3];
                
            else
           totalnewnewtrial_incongruent2=[totalnewnewtrial_incongruent2; totalnewnewtrial_incongruent(riu,:)];
            end
           
        end       
                        dumm=[3 totalnewnewtrial_incongruent(1,2:end)];
        totalnewnewtrial_incongruent2=[dumm; totalnewnewtrial_incongruent2];                           
     totalnewnewtrial_incongruent2(round(length(totalnewnewtrial_incongruent2)/2+1),1)=3;       
        end
        
        for seu=2:length(totalnewnewtrial_incongruent2)           
            if totalnewnewtrial_incongruent2(seu-1,1)==1 && totalnewnewtrial_incongruent2(seu,1)==2                              
                newone= [3 totalnewnewtrial_incongruent2(seu,2:end)];
                totalnewnewtrial_incongruent3=[totalnewnewtrial_incongruent2(1:seu-1,:); newone; totalnewnewtrial_incongruent2(seu:end,:)];
            end
        end
              
        for da=2:length(totalnewnewtrial_incongruent2)
            if totalnewnewtrial_incongruent2(da,1)==3               
            end           
        end
                
                    abc=find(totalnewnewtrial_incongruent2(:,1)==3);
        totaltrialbreak=(abc(1:10:end));
        totaltrialbreak=totaltrialbreak(2:end);


     sss=[ (1:length(totalnewnewtrial_incongruent2(:,1)))' totalnewnewtrial_incongruent2];         


dummysss=[sss nan(length(sss(:,1)),1) nan(length(sss(:,1)),1)];
%sss 1: trial n
%sss 2: trial type: 0: exogenous cue, 1: endogenous trial, 2: exogenous stream,3: beginning of trial/wait until response, 
%sss 3:where the cue is
%sss 4: where the stream is
%sss 5: where the stream will go
%sss 6: target type: 1-4: ori, 5: foil, 6-9: cue ori


%FLAP
%structure: totalnewnewtrial_incongruent2
%1:type of trial (0-3) %0 = exo trial switch %1= endo trial, %2 = exo trial %3= wait for response
%2: cue location (1-4)
%3: target location (1-4)
%4: next target location (1-4)
%5: target type: 5=foil, 6=up cue, 7=right cue, 8=down cue, 9=left cue

%target locations:
%1=up
%2=right
%3=down
%4=left
%cue locations
%6=up
%7=right
%8=down 
%9=left

%% THIS IS NOT NECESSARY ANYMORE
%Adjust for 'impossible cues' (e.g., when the stimulus is down and the cue
% %is dow, when the stimulus is up and the cue is up, etc)
% for sud=1:length(totalnewnewtrial_incongruent2)
% if totalnewnewtrial_incongruent2(sud,5)>5
%   if totalnewnewtrial_incongruent2(sud,3)==1 && totalnewnewtrial_incongruent2(sud,5)~=6 % target will appear up
%       possibleOri=[];
%       totalnewnewtrial_incongruent2(sud,5)=possibleOri(randi(2));
%   elseif totalnewnewtrial_incongruent2(sud,4)==2 && totalnewnewtrial_incongruent2(sud,5)~=7 % target will appear right
%   elseif totalnewnewtrial_incongruent2(sud,4)==3 && totalnewnewtrial_incongruent2(sud,5)~=8 % target will appear down
%         elseif totalnewnewtrial_incongruent2(sud,4)==4 && totalnewnewtrial_incongruent2(sud,5)~=9 % target will appear left
%   end
% end
% end
diditclose=10;
%end
save FLAPcondition2TrialMat.mat
%end
io